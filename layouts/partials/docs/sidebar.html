{{- $current := .Page -}}
{{- $all_pages := (where .Site.Pages "Section" .Section).ByWeight -}}

<div class=".sidebar">
<!-- Top Pages -->
{{ range $all_pages }}
   {{ if and .IsPage (eq .CurrentSection .FirstSection) }}
            {{- $selected := "" -}}
            {{- if eq $current .Page -}}
        	    {{- $selected = " selected" -}}
            {{- end -}}
    	    {{- $menu := .Page.Params.menu | default .Page.LinkTitle -}}
	        {{- if isset .Page.Params "link" }}
		        <div class="card {{ $selected }}"><a href="{{ .Page.Params.link }}" target="_blank">{{ $menu }}</a></div>
	        {{- else }}
		        <div class="card {{ $selected }}"><a href="{{ .Page.RelPermalink }}">{{ $menu }}</a></div>
	        {{- end -}}
    {{ end }}
{{ end }}

<!-- Sections -->
{{- range $all_pages -}}
    {{- if and .IsSection .Page.Parent.IsSection -}}
        <div class="section">
            <div class="title">{{.Title}}</div>
        {{ range .Pages.ByWeight }}
            {{- $selected := "" -}}
            {{- if eq $current .Page -}}
        	    {{- $selected = " selected" -}}
            {{- end -}}
    	    {{- $menu := .Page.Params.menu | default .Page.LinkTitle -}}
	        {{- if isset .Page.Params "link" }}
		        <div class="card {{ $selected }}"><a href="{{ .Page.Params.link }}" target="_blank">{{ $menu }}</a></div>
	        {{- else }}
		        <div class="card {{ $selected }}"><a href="{{ .Page.RelPermalink }}">{{ $menu }}</a></div>
	        {{- end -}}
        {{- end -}}
        </div>
    {{- end -}}
{{- end -}}
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $(".sidebar").mCustomScrollbar({
            theme: "minimal"
        });

        $('#dismiss, .page-overlay').on('click', function () {
            // hide sidebar
            $('.sidebar').removeClass('active');
            $('.sidebar').removeClass('ontop');
            
            // hide overlay
            $('.page-overlay').removeClass('active');
        });

        $('.sidebar-nav').on('click', function () {
            // open sidebar
            $('.sidebar').addClass('active');
            $('.sidebar').addClass('ontop');

            // fade in the overlay
            $('.page-overlay').addClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });
    });
</script>