{{- $current := .Page -}}
{{- $all_pages := (where .Site.Pages "Section" .Section).ByWeight -}}

<div class=".sidebar">
<!-- Overview Page -->
{{- with .Site.GetPage .Section }}
    {{ if not .Params.hidden }}
        {{- $selected := "" -}}
        {{- if eq $current .Page -}}
            {{- $selected = " selected-first" -}}
        {{- end -}}
        {{- $menu := .Page.Params.menu | default .Page.LinkTitle -}}
        {{- if isset .Page.Params "link" }}
            <div class="card {{ $selected }}"><a href="{{ .Page.Params.link }}" target="_blank" class="first">{{ $menu }}</a></div>
        {{- else }}
            <div class="card {{ $selected }}"><a href="{{ .Page.RelPermalink }}" class="first">{{ $menu }}</a></div>
        {{- end -}}
    {{- end -}}
{{ end -}}

<!-- Top Pages -->
{{ range $all_pages }}
    {{ if not .Params.hidden }}
        {{ if and .IsPage (eq .CurrentSection .FirstSection) }}
            {{- $selected := "" -}}
            {{- if eq $current .Page -}}
                {{- $selected = " selected" -}}
            {{- end -}}
            {{- $menu := .Page.Params.menu | default .Page.LinkTitle -}}
            {{- if isset .Page.Params "link" }}
                <div class="card item {{ $selected }}"><a href="{{ .Page.Params.link }}" target="_blank">{{ $menu }}</a></div>
            {{- else }}
                <div class="card item {{ $selected }}"><a href="{{ .Page.RelPermalink }}">{{ $menu }}</a></div>
            {{- end -}}
        {{- end -}}
    {{- end -}}
{{- end -}}

<!-- Sections -->
{{- range $all_pages -}}
    {{ if not .Params.hidden }}
        {{- if and .IsSection .Page.Parent.IsSection -}}
            <div class="section">
                <div class="title">{{.Title}}</div>
            {{ range .Pages.ByWeight }}
                {{- $selected := "" -}}
                {{- if eq $current .Page -}}
                    {{- $selected = " selected" -}}
                {{- end -}}
                {{- $menu := .Page.Params.menu | default .Page.LinkTitle -}}
                {{- if isset .Page.Params "link" }}
                    <div class="card {{ $selected }}"><a href="{{ .Page.Params.link }}" target="_blank">{{ $menu }}</a></div>
                {{- else }}
                    <div class="card {{ $selected }}"><a href="{{ .Page.RelPermalink }}">{{ $menu }}</a></div>
                {{- end -}}
            {{- end -}}
            </div>
        {{- end -}}
    {{- end -}}
{{- end -}}
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $(".sidebar").mCustomScrollbar({
            theme: "minimal"
        });

        $('#dismiss, .page-overlay').on('click', function () {
            // hide sidebar
            $('.sidebar-area').removeClass('active');
            $('.sidebar').removeClass('ontop');
            $('.sidebar').css({'font-size': ''});
            $('.sidebar').css({'width': ''});
            
            // renable elements
            $('.doc-area').css({'display': ''});
            $('.toc-area').css({'display': ''});
            $('.footer').css({'display': ''});
            
            // hide overlay
            $('.page-overlay').removeClass('active');
        });

        $('.sidebar-nav').on('click', function () {
            // open sidebar
            $('.sidebar-area').addClass('active');
            $('.sidebar').addClass('ontop');
            $('.sidebar').css({'font-size': '1.1em'});
            $('.sidebar').css({'width': '300px'});

            // fade in the overlay
            $('.page-overlay').addClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');

            // hide elements
            $('.doc-area').css({'display': 'none'});
            $('.toc-area').css({'display': 'none'});
            $('.footer').css({'display': 'none'});
        });
    });
</script>